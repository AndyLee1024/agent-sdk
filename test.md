# MCP (Model Context Protocol) 总结

## 什么是 MCP？

**MCP = Model Context Protocol（模型上下文协议）**。

MCP 是一种协议/规范，用于以标准化方式将外部上下文（文档、网页、工具输出、搜索结果等）暴露给 LLM 或基于 LLM 的系统。MCP 作为一个连接层，使模型服务（如 Claude）能够从第三方上下文源请求和接收上下文，而无需每个集成方都实现自定义适配器。

---

## MCP 的目的

MCP 的存在解决了以下核心问题：

1. **解耦模型服务器与多种上下文存储和工具**：模型提供商无需为每个数据源构建单独的连接器，任何系统都可以实现 MCP 规范并成为上下文提供者。

2. **实现安全、可审计和可插拔的上下文传递**：远程 MCP 服务器可以强制执行身份验证、访问控制、过滤，并一致地为模型转换结果。

3. **简化集成**：使文档数据库、搜索引擎、知识库、企业文件存储、自定义工具等更容易集成到 LLM 的上下文窗口中。

4. **标准化元数据和结构**：使消费者（模型）能够推理来源、可信度以及如何合并上下文。

---

## MCP 工作原理

### 架构概述

```
┌─────────────┐         ┌─────────────┐         ┌─────────────┐
│   用户      │ ──请求──▶│  模型服务   │ ──查询──▶│  MCP 服务器 │
│             │ ◀─回答── │ (MCP客户端) │ ◀─返回── │ (MCP服务端) │
└─────────────┘         └─────────────┘         └─────────────┘
```

### 工作流程

1. **MCP 服务器** 实现 MCP API（协议的端点和数据结构）
2. **模型服务**（或代理运行时）充当 MCP 客户端
3. 当模型需要外部上下文时，模型服务使用查询或上下文请求调用 MCP 服务器
4. MCP 服务器返回带有元数据的结构化上下文单元（块），包括：
   - 内容（content）
   - 来源 URL 或 ID（source/id）
   - 相关性分数（relevance score）
   - 类型（type）
   - 片段/完整内容（snippet/full content）
5. 模型服务将这些上下文块包含在提示中或传递给代理/工具机制

### 部署选项

- **本地 MCP 服务器**：运行在本地环境中
- **远程 MCP 服务器**：运行在客户选择的位置，支持企业数据保留在客户环境中，同时以受控方式暴露数据

---

## 主要功能暴露

通过 MCP 通常可以暴露以下功能：

- 搜索/排名结果
- 分块文档
- 元数据和来源信息
- 流式或分页传递（大结果集）
- 身份验证/权限检查

---

## 使用示例

### 示例 1：企业知识库集成

1. 实现一个 MCP 服务器，查询时：
   - 在企业向量数据库或搜索索引中搜索查询
   - 以 MCP 响应格式返回前 N 个文档块，包含内容、来源 URL 或文档 ID 和相关性分数
2. 配置 Claude 调用该 MCP 服务器获取用户查询的上下文
3. 代理将高相关性块与引用或"来源"元数据一起包含在提示中，模型基于这些结果回答

### 示例 2：Web 获取连接器

1. 创建 MCP 服务器获取网页，提取主要文本，分块并添加元数据（URL、标题、日期）
2. 模型服务查询此 MCP 以收集最新的网络上下文
3. 模型使用这些块来回答问题

### 示例 3：工具输出作为上下文

1. 一个工具（例如内部 API）运行并产生结构化结果
2. 该工具通过 MCP 端点暴露这些结果（或 MCP 服务器包装该工具）
3. 当代理执行需要该工具输出作为上下文时，模型服务查询 MCP 并以标准格式接收工具输出

### 示例 4：远程 MCP 服务器用于数据驻留

- 企业在其 VPC 内托管一个可以访问私有数据存储的 MCP 服务器
- Claude 被配置为调用该远程 MCP 服务器；数据永远不会离开企业环境，除了通过受控的 MCP API 和配置的策略

---

## 参考资料

- **官方 MCP 网站**：https://modelcontextprotocol.io
- **Anthropic 文档**：
  - [Agents SDK](https://docs.anthropic.com/en/docs/agents-sdk)
  - "MCP connector" 和 "Remote MCP servers" 相关页面